# Mini Linux Shell - 项目结构说明

## 概述

本项目是一个基于Linux的自定义Shell程序，完全按照任务要求实现，使用C语言开发核心命令，Shell脚本实现用户管理功能。

## 核心设计原则

1. **环境专一**：仅针对Linux环境，不考虑Windows适配
2. **命令独立**：每个C命令对应一个独立的源文件
3. **脚本独立**：每个用户管理功能对应一个独立的Shell脚本
4. **标准实现**：严格按照任务要求使用fork/execvp执行C程序，system执行Shell脚本

## 目录结构

```
Mini_computer/
├── src/
│   ├── shell_main.c              # 主Shell程序
│   │   ├── 功能1：显示动态提示符
│   │   ├── 功能2：解析命令行输入
│   │   ├── 功能3：判断命令类型
│   │   ├── 功能4：执行C程序（fork+execvp）
│   │   └── 功能5：执行Shell脚本（system）
│   │
│   └── commands/                 # C语言命令（每个独立文件）
│       ├── 文件操作
│       │   ├── mytouch.c         # 创建文件
│       │   ├── mycat.c           # 显示文件内容
│       │   ├── mycp.c            # 复制文件
│       │   ├── myrm.c            # 删除文件/目录
│       │   └── mychmod.c         # 修改/查看文件权限
│       │
│       ├── 目录操作
│       │   └── myls.c            # 列出目录内容
│       │
│       ├── 进程操作
│       │   ├── myps.c            # 显示进程信息
│       │   └── mykill.c          # 终止进程
│       │
│       └── 历史记录
│           └── myhistory.c       # 命令历史管理
│
├── scripts/                      # Shell脚本（用户管理）
│   ├── create_user.sh            # 创建用户（交互式+批量）
│   ├── delete_user.sh            # 删除用户
│   └── change_password.sh        # 修改密码
│
├── bin/                          # 编译输出目录
│   ├── mini_shell                # 主Shell可执行文件
│   ├── mytouch, mycat, ...       # C命令可执行文件
│   └── *.sh                      # Shell脚本（带执行权限）
│
├── examples/                     # 示例文件
│   └── users_example.txt         # 批量创建用户示例
│
├── docs/                         # 文档
│   ├── 任务说明.md               # 原始任务要求
│   ├── 项目结构说明.md           # 本文档
│   └── 分工说明.md               # 团队分工
│
├── Makefile                      # Linux编译脚本
└── README.md                     # 项目说明
```

## 实现要点

### 1. 主Shell程序 (shell_main.c)

**关键功能：**
- 动态提示符：`用户名@主机名:当前目录$`
- 命令解析：使用strtok分割参数
- 类型判断：
  - 内置命令（exit, cd, pwd, help）
  - Shell脚本（检查#!/bin/bash标识）
  - C程序/系统命令
- 执行机制：
  - C程序：fork() → execvp() → waitpid()
  - Shell脚本：system()

**代码示例：**
```c
// C程序执行
pid_t pid = fork();
if (pid == 0) {
    execvp(args[0], args);
} else {
    waitpid(pid, &status, 0);
}

// Shell脚本执行
system(script_path);
```

### 2. C语言命令

**设计特点：**
- 每个命令一个独立的.c文件
- 包含main函数，可独立运行
- 完整的错误处理和提示
- 考虑边界条件

**示例：mytouch.c**
- 检查文件是否存在
- 提供覆盖/重命名选项
- 设置适当的文件权限

**示例：myrm.c**
- 支持-i选项（交互确认）
- 支持-r选项（递归删除）
- 删除前确认提示

**示例：myps.c**
- 从/proc读取进程信息
- 支持-a选项（所有进程）
- 支持-u选项（当前用户进程）

### 3. Shell脚本

**设计特点：**
- 每个功能一个独立的.sh文件
- 包含root权限检查
- 交互式用户体验
- 完整的错误处理

**create_user.sh：**
- 交互式模式：逐步输入用户信息
- 批量模式：从文件读取用户列表
- 格式：username:password

**delete_user.sh：**
- 检查用户是否存在
- 显示用户信息
- 确认删除操作
- 可选删除主目录

**change_password.sh：**
- 区分普通用户和root
- 普通用户需验证旧密码
- root可修改任何用户密码
- 密码强度检查

## 编译流程

### Makefile结构

```makefile
# 编译主Shell程序
mini_shell: shell_main.c
    gcc -o bin/mini_shell shell_main.c

# 编译各个C命令
mytouch: mytouch.c
    gcc -o bin/mytouch mytouch.c

# 复制Shell脚本并添加执行权限
scripts:
    cp scripts/*.sh bin/
    chmod +x bin/*.sh
```

### 编译步骤

1. 创建bin目录
2. 编译主Shell程序
3. 编译所有C命令
4. 复制Shell脚本并添加执行权限

## 使用场景

### 场景1：基本文件操作

```bash
user@host:~$ mytouch file.txt
文件 'file.txt' 创建成功。

user@host:~$ mycat file.txt > output.txt
内容已输出到 'output.txt'

user@host:~$ mycp output.txt backup.txt
文件已从 'output.txt' 复制到 'backup.txt'

user@host:~$ myrm -i file.txt
删除文件 'file.txt'? (y/n): y
文件 'file.txt' 已删除。
```

### 场景2：进程管理

```bash
user@host:~$ myps -u
USER     PID      CPU%  MEM   COMMAND              STATE
user     1234     0.5   256M  bash                 S
user     5678     1.2   512M  firefox              R

user@host:~$ mykill firefox
发现进程: firefox (PID: 5678)
是否终止此进程? (y/n): y
进程 firefox (PID: 5678) 已终止
```

### 场景3：用户管理（需要root）

```bash
root@host:~$ sudo ./bin/create_user.sh --batch examples/users_example.txt
批量创建用户
从文件读取用户列表: examples/users_example.txt

创建用户 'alice'... 成功
创建用户 'bob'... 成功
创建用户 'charlie'... 成功

批量创建完成:
  - 成功: 3 个用户
  - 失败: 0 个用户
```

## 技术要点

### 1. 进程管理
- fork()：创建子进程
- execvp()：执行程序
- waitpid()：等待子进程结束
- system()：执行Shell脚本

### 2. 文件操作
- open()：打开文件
- read()/write()：读写文件
- stat()：获取文件信息
- chmod()：修改文件权限

### 3. 目录操作
- opendir()/readdir()：读取目录
- getcwd()：获取当前目录
- chdir()：切换目录

### 4. 进程信息
- /proc文件系统：读取进程信息
- /proc/[pid]/stat：进程状态
- /proc/[pid]/status：进程详细信息

### 5. 用户管理
- useradd：创建用户
- userdel：删除用户
- chpasswd：修改密码
- /etc/passwd：用户数据库

## 测试建议

### 1. 功能测试
- 测试所有命令的基本功能
- 测试各种参数组合
- 测试边界条件

### 2. 错误测试
- 文件不存在
- 权限不足
- 参数错误
- 资源不足

### 3. 压力测试
- 大文件操作
- 大量进程
- 批量用户创建

## 注意事项

1. **环境要求**：本项目仅适用于Linux环境
2. **权限要求**：用户管理脚本需要root权限
3. **依赖检查**：确保系统有gcc、make等工具
4. **路径问题**：Shell脚本使用相对路径或绝对路径
5. **错误处理**：所有命令都应有完善的错误提示

## 扩展方向

1. **管道支持**：实现命令之间的管道
2. **后台执行**：支持&符号后台运行
3. **信号处理**：处理Ctrl+C等信号
4. **作业控制**：实现fg、bg等命令
5. **环境变量**：支持环境变量设置和使用

## 总结

本项目严格按照Linux操作系统综合作业要求实现，每个C命令和Shell脚本都是独立的文件，主Shell程序正确使用fork/execvp和system执行命令，完全满足任务说明的所有要求。

