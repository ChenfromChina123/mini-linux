 
LINUX 操作系统综合作业 
  
开发设计一个具备基础功能的Shell 
一．目标：掌握Linux 系统交互原理、进程管理及脚本编程技术，设计并实现一个具备基础功能的Shell。要求程序具备基本交互能力，支持命令解析、命令执
行、历史命令记录等功能。   
二．基本功能：  
1.命令行输入：输出命令行提示符，提示符最低要求为固定字符串，扩展要求为动态提示符，如以用户名和主机名为提示符、或者以当前目录和用户名为提示符，可自己设计动态提示符。 
2.命令解析：解析用户输入的命令，分割成参数。 
3.命令执行：执行用户输入的命令，命令分成以下2 种： 
第1 种：自己写的C 语言程序，包含三部分基本功能，一是文件基本操作，二是
目录基本操作，三是进程基本操作。 （1）文件基本操作： 
（a）创建新文件。创建文件功能（文本文件），要求判断是否有重名文件存在，如有给出提示，是覆盖原有文件，还是以另外的名字创建，命令名为mytouch。   （功能类似命令touch aa.txt ） 
（b）显示文件内容。基本要求：显示指定文本文件的内容，命令名为mycat。（功能类似命令 cat aa.txt ）。扩展要求：重定向功能，为mycat 增加重定向功能， 
用>将文件内容输出至指定文件中，>>将文件内容追加输出至指定文件中。 （c）文件复制功能，命令名为mycp。（功能类似命令cp aa.txt  bb.txt ） 
（d）文件删除功能，要求删除前给出提示，用户确定之后再删除。命令名为myrm（功能类似带参数-i 的rm 命令） 
（e）修改/查看文件权限，命令名为mychmod（功能类似命令 chmod *** aa.txt），若输入命令为mychmod aa.txt 则显示文件aa.txt 的权限，若输入命令为mychmod 
*** aa.txt，则修改文件aa.txt，其中***表示文件权限。  说明：  
（2）目录基本操作： 
（a）显示目录，命令名为myls。（功能类似命令ls 目录名，默认不带选项，-l 选项表示长格式显示。） 
（b）删除目录，命令名为myrm。（功能类似命令rm,要求模仿rm 命令选项的功
能，实现两个选项-r、-i）    （3）进程基本操作： 
（a）显示系统中进程信息，命令名为myps。（功能类似命令ps，请自己设计显示进程哪些信息，参考ps 命令的选项，要求至少实现两个选项的功能。） 
（b）终止进程，输入进程名称，如果系统中有该进程，则终止进程，否则输出
提示信息。  说明： 
①每一个功能的操作命令对应一个C 语言程序，不允许使用一个函数对应一个操作命令的形式。 
②以上只是给出了每个命令对应功能的简单描述，请分析需要考虑哪些边界条件，并在程序中实现。 
③文件及目录操作中，文件及目录名可包含目录，如未指定目录，则默认为当前目录。 
   
第2 种：自己写的shell 脚本程序，包含用户管理基本功能： 
（1）创建用户：包括两种形式，一是交互式输入用户名并创建；二是批量创建一批用户，用户名从文本文件中读取。 
（2）删除用户：输入待删除的用户名进行删除，若不存在该用户，则给出提示。 （3）设置/修改用户密码：根据权限进行密码修改，根据自己使用其他系统的体验，设计合适的密码修改方法，需要考虑不同身份的用户如何修改密码，如普通用户、root。 
 说明：以上三个功能，每个操作命令单独对应一个shell 程序，不要以函数的
形式放在一个shell 程序中。   
实现命令执行功能，能够运行上述两种命令。 
对于C 语言程序，按照以下流程调用：使用fork()创建子进程；在子进程中使用execvp()执行用户输入的命令；父进程使用waitpid()等待子进程结束。 
对于shell 脚本程序，使用system 函数调用。   
4.命令历史记录：记录用户输入的命令，以便查看和重用。请参考LINUX 中history 命令的功能，了解-a、-n、-c 选项，自己设计一个类似的功能，命令名为 myhistory， 基本要求为实现-a 选项，扩展要求是实现-n,-c 选项。请自己确定
用什么数据结构实现命令历史记录，并能说明原因。     
三．实现说明及参考流程： 
说明：模拟shell 功能，显示提示符，用户输入命令字符串，根据用户输入的字符串判断命令是shell 脚本还是C 语言程序，根据不同的命令类型进行相应的处理；若接收到的命令为exit，则父进程结束，退出shell。如果接收到的是无效命令，则显示提示信息”command not found”。执行完一条命令后，继续显示
提示符，等待接收下一条命令。  参考流程： 
步骤1：显示命令提示符，等待用户输入。 
步骤2：读取命令及分析：读取命令字符串，并进行分割。 
步骤3：命令判断及执行：根据输入的命令字符串判断其类型，考虑以下不同的命令类型： 
（1）退出命令 (exit)：如果用户输入 exit，则父进程（即Shell 程序本身）直接结束，整个程序退出。 
（2）Shell 脚本：如果命令指向一个有效的、可执行的Shell 脚本文件（如 ./test.sh），则用system 调用该脚本； 
（3）C 程序：如果命令指向一个有效的C 语言源代码文件（如 ./hello.c），则创建一个子进程。在子进程中使用execvp()执行用户输入的命令，父进程等待
子进程完成。 
（4）无效命令：如果命令既不是exit，也找不到对应的可执行脚本或C 源文件，则直接在屏幕上显示错误信息 command not found。 
循环与等待,除非是exit 命令，否则在执行完任何一条命令（或提示无效后），程序流程会重新回到步骤1，再次显示提示符，等待下一条命令，形成一个循环。   
四．要求： 
1. 以小组为单位完成并演示，每个小组最多4 人。 
2. 每个小组提交以下文档： （1）需求分析文档； 
（2）测试文档； （3）源代码； 
（4）PPT 文档，PPT 内容包括具体分工，各个功能模块的实现思路，关键代码，
运行截图，收获与不足等。   
五．附加题： 
新增一个LINUX 系统调用。网上搜索资料，了解LINUX 系统调用原理，为 LINUX 增加一个新的系统调用，功能自己设定，如进行某种数学计算，或者是输
出某些系统参数等。  参考网址： 
https://www.codenong.com/cs106950550/ 
https://blog.csdn.net/weixin_42372407/article/details/129322861 
     